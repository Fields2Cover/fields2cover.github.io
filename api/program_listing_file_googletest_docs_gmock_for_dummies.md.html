

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Program Listing for File gmock_for_dummies.md &mdash; Fields2Cover latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../_static/code-tabs.css?v=1bc26e2f" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="https://fields2cover.github.io/api/program_listing_file_googletest_docs_gmock_for_dummies.md.html" />
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=c6e86fd7"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/code-tabs.js?v=c983d12e"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_fields2cover.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Fields2Cover</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/migration_to_v2.html">Migration guide to version 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="f2c_library.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Fields2Cover</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Program Listing for File gmock_for_dummies.md</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/program_listing_file_googletest_docs_gmock_for_dummies.md.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="program-listing-for-file-gmock-for-dummies-md">
<span id="program-listing-file-googletest-docs-gmock-for-dummies-md"></span><h1>Program Listing for File gmock_for_dummies.md<a class="headerlink" href="#program-listing-for-file-gmock-for-dummies-md" title="Link to this heading"></a></h1>
<p>↰ <a class="reference internal" href="file_googletest_docs_gmock_for_dummies.md.html#file-googletest-docs-gmock-for-dummies-md"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">googletest/docs/gmock_for_dummies.md</span></code>)</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gh"># gMock for Dummies</span>

<span class="gu">## What Is gMock?</span>

When you write a prototype or test, often it&#39;s not feasible or wise to rely on
real objects entirely. A <span class="gs">**mock object**</span> implements the same interface as a real
object (so it can be used as one), but lets you specify at run time how it will
be used and what it should do (which methods will be called? in which order? how
many times? with what arguments? what will they return? etc).

It is easy to confuse the term <span class="ge">*fake objects*</span> with mock objects. Fakes and mocks
actually mean very different things in the Test-Driven Development (TDD)
community:

<span class="k">*</span><span class="w"> </span>  <span class="gs">**Fake**</span> objects have working implementations, but usually take some
    shortcut (perhaps to make the operations less expensive), which makes them
    not suitable for production. An in-memory file system would be an example of
    a fake.
<span class="k">*</span><span class="w"> </span>  <span class="gs">**Mocks**</span> are objects pre-programmed with <span class="ge">*expectations*</span>, which form a
    specification of the calls they are expected to receive.

If all this seems too abstract for you, don&#39;t worry - the most important thing
to remember is that a mock allows you to check the <span class="ge">*interaction*</span> between itself
and code that uses it. The difference between fakes and mocks shall become much
clearer once you start to use mocks.

<span class="gs">**gMock**</span> is a library (sometimes we also call it a &quot;framework&quot; to make it sound
cool) for creating mock classes and using them. It does to C++ what
jMock/EasyMock does to Java (well, more or less).

When using gMock,

<span class="k">1.</span>  first, you use some simple macros to describe the interface you want to
    mock, and they will expand to the implementation of your mock class;
<span class="k">2.</span>  next, you create some mock objects and specify its expectations and behavior
    using an intuitive syntax;
<span class="k">3.</span>  then you exercise code that uses the mock objects. gMock will catch any
    violation to the expectations as soon as it arises.

<span class="gu">## Why gMock?</span>

While mock objects help you remove unnecessary dependencies in tests and make
them fast and reliable, using mocks manually in C++ is <span class="ge">*hard*</span>:

<span class="k">*</span><span class="w"> </span>  Someone has to implement the mocks. The job is usually tedious and
    error-prone. No wonder people go great distance to avoid it.
<span class="k">*</span><span class="w"> </span>  The quality of those manually written mocks is a bit, uh, unpredictable. You
    may see some really polished ones, but you may also see some that were
    hacked up in a hurry and have all sorts of ad hoc restrictions.
<span class="k">*</span><span class="w"> </span>  The knowledge you gained from using one mock doesn&#39;t transfer to the next
    one.

In contrast, Java and Python programmers have some fine mock frameworks (jMock,
EasyMock, etc), which automate the creation of mocks. As a result, mocking is a
proven effective technique and widely adopted practice in those communities.
Having the right tool absolutely makes the difference.

gMock was built to help C++ programmers. It was inspired by jMock and EasyMock,
but designed with C++&#39;s specifics in mind. It is your friend if any of the
following problems is bothering you:

<span class="k">*</span><span class="w"> </span>  You are stuck with a sub-optimal design and wish you had done more
    prototyping before it was too late, but prototyping in C++ is by no means
    &quot;rapid&quot;.
<span class="k">*</span><span class="w"> </span>  Your tests are slow as they depend on too many libraries or use expensive
    resources (e.g. a database).
<span class="k">*</span><span class="w"> </span>  Your tests are brittle as some resources they use are unreliable (e.g. the
    network).
<span class="k">*</span><span class="w"> </span>  You want to test how your code handles a failure (e.g. a file checksum
    error), but it&#39;s not easy to cause one.
<span class="k">*</span><span class="w"> </span>  You need to make sure that your module interacts with other modules in the
    right way, but it&#39;s hard to observe the interaction; therefore you resort to
    observing the side effects at the end of the action, but it&#39;s awkward at
    best.
<span class="k">*</span><span class="w"> </span>  You want to &quot;mock out&quot; your dependencies, except that they don&#39;t have mock
    implementations yet; and, frankly, you aren&#39;t thrilled by some of those
    hand-written mocks.

We encourage you to use gMock as

<span class="k">*</span><span class="w"> </span>  a <span class="ge">*design*</span> tool, for it lets you experiment with your interface design early
    and often. More iterations lead to better designs!
<span class="k">*</span><span class="w"> </span>  a <span class="ge">*testing*</span> tool to cut your tests&#39; outbound dependencies and probe the
    interaction between your module and its collaborators.

<span class="gu">## Getting Started</span>

gMock is bundled with googletest.

<span class="gu">## A Case for Mock Turtles</span>

Let&#39;s look at an example. Suppose you are developing a graphics program that
relies on a [<span class="nt">LOGO</span>](<span class="na">https://en.wikipedia.org/wiki/Logo_programming_language</span>)-like
API for drawing. How would you test that it does the right thing? Well, you can
run it and compare the screen with a golden screen snapshot, but let&#39;s admit it:
tests like this are expensive to run and fragile (What if you just upgraded to a
shiny new graphics card that has better anti-aliasing? Suddenly you have to
update all your golden images.). It would be too painful if all your tests are
like this. Fortunately, you learned about
[<span class="nt">Dependency Injection</span>](<span class="na">https://en.wikipedia.org/wiki/Dependency_injection</span>) and know the right thing
to do: instead of having your application talk to the system API directly, wrap
the API in an interface (say, <span class="sb">`Turtle`</span>) and code to that interface:

<span class="sb">```cpp</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Turtle</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Turtle</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">PenUp</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PenDown</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Forward</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">distance</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Turn</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">degrees</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GoTo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetX</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetY</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
<span class="sb">```</span>

(Note that the destructor of <span class="sb">`Turtle`</span> <span class="gs">**must**</span> be virtual, as is the case for
<span class="gs">**all**</span> classes you intend to inherit from - otherwise the destructor of the
derived class will not be called when you delete an object through a base
pointer, and you&#39;ll get corrupted program states like memory leaks.)

You can control whether the turtle&#39;s movement will leave a trace using <span class="sb">`PenUp()`</span>
and <span class="sb">`PenDown()`</span>, and control its movement using <span class="sb">`Forward()`</span>, <span class="sb">`Turn()`</span>, and
<span class="sb">`GoTo()`</span>. Finally, <span class="sb">`GetX()`</span> and <span class="sb">`GetY()`</span> tell you the current position of the
turtle.

Your program will normally use a real implementation of this interface. In
tests, you can use a mock implementation instead. This allows you to easily
check what drawing primitives your program is calling, with what arguments, and
in which order. Tests written this way are much more robust (they won&#39;t break
because your new machine does anti-aliasing differently), easier to read and
maintain (the intent of a test is expressed in the code, not in some binary
images), and run <span class="ge">*much, much faster*</span>.

<span class="gu">## Writing the Mock Class</span>

If you are lucky, the mocks you need to use have already been implemented by
some nice people. If, however, you find yourself in the position to write a mock
class, relax - gMock turns this task into a fun game! (Well, almost.)

<span class="gu">### How to Define It</span>

Using the <span class="sb">`Turtle`</span> interface as example, here are the simple steps you need to
follow:

<span class="k">*</span><span class="w"> </span>  Derive a class <span class="sb">`MockTurtle`</span> from <span class="sb">`Turtle`</span>.
<span class="k">*</span><span class="w"> </span>  Take a <span class="ge">*virtual*</span> function of <span class="sb">`Turtle`</span> (while it&#39;s possible to
    [<span class="nt">mock non-virtual methods using templates</span>](<span class="na">gmock_cook_book.md#MockingNonVirtualMethods</span>),
    it&#39;s much more involved).
<span class="k">*</span><span class="w"> </span>  In the <span class="sb">`public:`</span> section of the child class, write <span class="sb">`MOCK_METHOD();`</span>
<span class="k">*</span><span class="w"> </span>  Now comes the fun part: you take the function signature, cut-and-paste it
    into the macro, and add two commas - one between the return type and the
    name, another between the name and the argument list.
<span class="k">*</span><span class="w"> </span>  If you&#39;re mocking a const method, add a 4th parameter containing <span class="sb">`(const)`</span>
    (the parentheses are required).
<span class="k">*</span><span class="w"> </span>  Since you&#39;re overriding a virtual method, we suggest adding the <span class="sb">`override`</span>
    keyword. For const methods the 4th parameter becomes <span class="sb">`(const, override)`</span>,
    for non-const methods just <span class="sb">`(override)`</span>. This isn&#39;t mandatory.
<span class="k">*</span><span class="w"> </span>  Repeat until all virtual functions you want to mock are done. (It goes
    without saying that <span class="ge">*all*</span> pure virtual methods in your abstract class must
    be either mocked or overridden.)

After the process, you should have something like:

<span class="sb">```cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gmock/gmock.h&gt;</span><span class="c1">  // Brings in gMock.</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MockTurtle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Turtle</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="w"> </span><span class="n">PenUp</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="w">  </span><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="w"> </span><span class="n">PenDown</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="w">  </span><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="w"> </span><span class="n">Forward</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">distance</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="w">  </span><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="w"> </span><span class="n">Turn</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">degrees</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="w">  </span><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="w"> </span><span class="n">GoTo</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="w">  </span><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">GetX</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="p">,</span><span class="w"> </span><span class="k">override</span><span class="p">));</span>
<span class="w">  </span><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">GetY</span><span class="p">,</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="p">,</span><span class="w"> </span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
<span class="sb">```</span>

You don&#39;t need to define these mock methods somewhere else - the <span class="sb">`MOCK_METHOD`</span>
macro will generate the definitions for you. It&#39;s that simple!

<span class="gu">### Where to Put It</span>

When you define a mock class, you need to decide where to put its definition.
Some people put it in a <span class="sb">`_test.cc`</span>. This is fine when the interface being mocked
(say, <span class="sb">`Foo`</span>) is owned by the same person or team. Otherwise, when the owner of
<span class="sb">`Foo`</span> changes it, your test could break. (You can&#39;t really expect <span class="sb">`Foo`</span>&#39;s
maintainer to fix every test that uses <span class="sb">`Foo`</span>, can you?)

Generally, you should not mock classes you don&#39;t own. If you must mock such a
class owned by others, define the mock class in <span class="sb">`Foo`</span>&#39;s Bazel package (usually
the same directory or a <span class="sb">`testing`</span> sub-directory), and put it in a <span class="sb">`.h`</span> and a
<span class="sb">`cc_library`</span> with <span class="sb">`testonly=True`</span>. Then everyone can reference them from their
tests. If <span class="sb">`Foo`</span> ever changes, there is only one copy of <span class="sb">`MockFoo`</span> to change, and
only tests that depend on the changed methods need to be fixed.

Another way to do it: you can introduce a thin layer <span class="sb">`FooAdaptor`</span> on top of
<span class="sb">`Foo`</span> and code to this new interface. Since you own <span class="sb">`FooAdaptor`</span>, you can absorb
changes in <span class="sb">`Foo`</span> much more easily. While this is more work initially, carefully
choosing the adaptor interface can make your code easier to write and more
readable (a net win in the long run), as you can choose <span class="sb">`FooAdaptor`</span> to fit your
specific domain much better than <span class="sb">`Foo`</span> does.

<span class="gu">## Using Mocks in Tests</span>

Once you have a mock class, using it is easy. The typical work flow is:

<span class="k">1.</span>  Import the gMock names from the <span class="sb">`testing`</span> namespace such that you can use
    them unqualified (You only have to do it once per file). Remember that
    namespaces are a good idea.
<span class="k">2.</span>  Create some mock objects.
<span class="k">3.</span>  Specify your expectations on them (How many times will a method be called?
    With what arguments? What should it do? etc.).
<span class="k">4.</span>  Exercise some code that uses the mocks; optionally, check the result using
    googletest assertions. If a mock method is called more than expected or with
    wrong arguments, you&#39;ll get an error immediately.
<span class="k">5.</span>  When a mock is destructed, gMock will automatically check whether all
    expectations on it have been satisfied.

Here&#39;s an example:

<span class="sb">```cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;path/to/mock-turtle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gmock/gmock.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtest/gtest.h&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AtLeast</span><span class="p">;</span><span class="w">                         </span><span class="c1">// #1</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">PainterTest</span><span class="p">,</span><span class="w"> </span><span class="n">CanDrawSomething</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">MockTurtle</span><span class="w"> </span><span class="n">turtle</span><span class="p">;</span><span class="w">                              </span><span class="c1">// #2</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">PenDown</span><span class="p">())</span><span class="w">                  </span><span class="c1">// #3</span>
<span class="w">      </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>

<span class="w">  </span><span class="n">Painter</span><span class="w"> </span><span class="nf">painter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">turtle</span><span class="p">);</span><span class="w">                       </span><span class="c1">// #4</span>

<span class="w">  </span><span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">painter</span><span class="p">.</span><span class="n">DrawCircle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">));</span><span class="w">      </span><span class="c1">// #5</span>
<span class="p">}</span>
<span class="sb">```</span>

As you might have guessed, this test checks that <span class="sb">`PenDown()`</span> is called at least
once. If the <span class="sb">`painter`</span> object didn&#39;t call this method, your test will fail with
a message like this:

<span class="sb">```text</span>
path/to/my_test.cc:119: Failure
Actual function call count doesn&#39;t match this expectation:
Actually: never called;
Expected: called at least once.
Stack trace:
...
<span class="sb">```</span>

<span class="gs">**Tip 1:**</span> If you run the test from an Emacs buffer, you can hit <span class="sb">`&lt;Enter&gt;`</span> on
the line number to jump right to the failed expectation.

<span class="gs">**Tip 2:**</span> If your mock objects are never deleted, the final verification won&#39;t
happen. Therefore it&#39;s a good idea to turn on the heap checker in your tests
when you allocate mocks on the heap. You get that automatically if you use the
<span class="sb">`gtest_main`</span> library already.

<span class="gu">###### Expectation Ordering</span>

<span class="gs">**Important note:**</span> gMock requires expectations to be set <span class="gs">**before**</span> the mock
functions are called, otherwise the behavior is <span class="gs">**undefined**</span>. Do not alternate
between calls to <span class="sb">`EXPECT_CALL()`</span> and calls to the mock functions, and do not set
any expectations on a mock after passing the mock to an API.

This means <span class="sb">`EXPECT_CALL()`</span> should be read as expecting that a call will occur
<span class="ge">*in the future*</span>, not that a call has occurred. Why does gMock work like that?
Well, specifying the expectation beforehand allows gMock to report a violation
as soon as it rises, when the context (stack trace, etc) is still available.
This makes debugging much easier.

Admittedly, this test is contrived and doesn&#39;t do much. You can easily achieve
the same effect without using gMock. However, as we shall reveal soon, gMock
allows you to do <span class="ge">*so much more*</span> with the mocks.

<span class="gu">## Setting Expectations</span>

The key to using a mock object successfully is to set the <span class="ge">*right expectations*</span>
on it. If you set the expectations too strict, your test will fail as the result
of unrelated changes. If you set them too loose, bugs can slip through. You want
to do it just right such that your test can catch exactly the kind of bugs you
intend it to catch. gMock provides the necessary means for you to do it &quot;just
right.&quot;

<span class="gu">### General Syntax</span>

In gMock we use the <span class="sb">`EXPECT_CALL()`</span> macro to set an expectation on a mock
method. The general syntax is:

<span class="sb">```cpp</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_object</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="p">(</span><span class="n">matchers</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">cardinality</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
<span class="sb">```</span>

The macro has two arguments: first the mock object, and then the method and its
arguments. Note that the two are separated by a comma (<span class="sb">`,`</span>), not a period (<span class="sb">`.`</span>).
(Why using a comma? The answer is that it was necessary for technical reasons.)
If the method is not overloaded, the macro can also be called without matchers:

<span class="sb">```cpp</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_object</span><span class="p">,</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">overloaded</span><span class="o">-</span><span class="n">method</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">cardinality</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
<span class="sb">```</span>

This syntax allows the test writer to specify &quot;called with any arguments&quot;
without explicitly specifying the number or types of arguments. To avoid
unintended ambiguity, this syntax may only be used for methods that are not
overloaded.

Either form of the macro can be followed by some optional <span class="ge">*clauses*</span> that provide
more information about the expectation. We&#39;ll discuss how each clause works in
the coming sections.

This syntax is designed to make an expectation read like English. For example,
you can probably guess that

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GetX</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">150</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">200</span><span class="p">));</span>
<span class="sb">```</span>

says that the <span class="sb">`turtle`</span> object&#39;s <span class="sb">`GetX()`</span> method will be called five times, it
will return 100 the first time, 150 the second time, and then 200 every time.
Some people like to call this style of syntax a Domain-Specific Language (DSL).

{: .callout .note}
<span class="gs">**Note:**</span> Why do we use a macro to do this? Well it serves two purposes: first
it makes expectations easily identifiable (either by <span class="sb">`grep`</span> or by a human
reader), and second it allows gMock to include the source file location of a
failed expectation in messages, making debugging easier.

<span class="gu">### Matchers: What Arguments Do We Expect?</span>

When a mock function takes arguments, we may specify what arguments we are
expecting, for example:

<span class="sb">```cpp</span>
<span class="c1">// Expects the turtle to move forward by 100 units.</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">Forward</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<span class="sb">```</span>

Oftentimes you do not want to be too specific. Remember that talk about tests
being too rigid? Over specification leads to brittle tests and obscures the
intent of tests. Therefore we encourage you to specify only what&#39;s necessary—no
more, no less. If you aren&#39;t interested in the value of an argument, write <span class="sb">`_`</span>
as the argument, which means &quot;anything goes&quot;:

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
<span class="c1">// Expects that the turtle jumps to somewhere on the x=50 line.</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GoTo</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">));</span>
<span class="sb">```</span>

<span class="sb">`_`</span> is an instance of what we call <span class="gs">**matchers**</span>. A matcher is like a predicate
and can test whether an argument is what we&#39;d expect. You can use a matcher
inside <span class="sb">`EXPECT_CALL()`</span> wherever a function argument is expected. <span class="sb">`_`</span> is a
convenient way of saying &quot;any value&quot;.

In the above examples, <span class="sb">`100`</span> and <span class="sb">`50`</span> are also matchers; implicitly, they are
the same as <span class="sb">`Eq(100)`</span> and <span class="sb">`Eq(50)`</span>, which specify that the argument must be
equal (using <span class="sb">`operator==`</span>) to the matcher argument. There are many
[<span class="nt">built-in matchers</span>](<span class="na">reference/matchers.md</span>) for common types (as well as
[<span class="nt">custom matchers</span>](<span class="na">gmock_cook_book.md#NewMatchers</span>)); for example:

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Ge</span><span class="p">;</span>
<span class="p">...</span>
<span class="c1">// Expects the turtle moves forward by at least 100.</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">Forward</span><span class="p">(</span><span class="n">Ge</span><span class="p">(</span><span class="mi">100</span><span class="p">)));</span>
<span class="sb">```</span>

If you don&#39;t care about <span class="ge">*any*</span> arguments, rather than specify <span class="sb">`_`</span> for each of
them you may instead omit the parameter list:

<span class="sb">```cpp</span>
<span class="c1">// Expects the turtle to move forward.</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">Forward</span><span class="p">);</span>
<span class="c1">// Expects the turtle to jump somewhere.</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GoTo</span><span class="p">);</span>
<span class="sb">```</span>

This works for all non-overloaded methods; if a method is overloaded, you need
to help gMock resolve which overload is expected by specifying the number of
arguments and possibly also the
[<span class="nt">types of the arguments</span>](<span class="na">gmock_cook_book.md#SelectOverload</span>).

<span class="gu">### Cardinalities: How Many Times Will It Be Called?</span>

The first clause we can specify following an <span class="sb">`EXPECT_CALL()`</span> is <span class="sb">`Times()`</span>. We
call its argument a <span class="gs">**cardinality**</span> as it tells <span class="ge">*how many times*</span> the call should
occur. It allows us to repeat an expectation many times without actually writing
it as many times. More importantly, a cardinality can be &quot;fuzzy&quot;, just like a
matcher can be. This allows a user to express the intent of a test exactly.

An interesting special case is when we say <span class="sb">`Times(0)`</span>. You may have guessed - it
means that the function shouldn&#39;t be called with the given arguments at all, and
gMock will report a googletest failure whenever the function is (wrongfully)
called.

We&#39;ve seen <span class="sb">`AtLeast(n)`</span> as an example of fuzzy cardinalities earlier. For the
list of built-in cardinalities you can use, see
[<span class="nt">here</span>](<span class="na">gmock_cheat_sheet.md#CardinalityList</span>).

The <span class="sb">`Times()`</span> clause can be omitted. **If you omit <span class="sb">`Times()`</span>, gMock will infer
the cardinality for you.** The rules are easy to remember:

<span class="k">*</span><span class="w"> </span>  If <span class="gs">**neither**</span> <span class="sb">`WillOnce()`</span> <span class="gs">**nor**</span> <span class="sb">`WillRepeatedly()`</span> is in the
    <span class="sb">`EXPECT_CALL()`</span>, the inferred cardinality is <span class="sb">`Times(1)`</span>.
<span class="k">*</span><span class="w"> </span>  If there are <span class="ge">*n*</span> <span class="sb">`WillOnce()`</span>&#39;s but <span class="gs">**no**</span> <span class="sb">`WillRepeatedly()`</span>, where <span class="ge">*n*</span> &gt;=
    1, the cardinality is <span class="sb">`Times(n)`</span>.
<span class="k">*</span><span class="w"> </span>  If there are <span class="ge">*n*</span> <span class="sb">`WillOnce()`</span>&#39;s and <span class="gs">**one**</span> <span class="sb">`WillRepeatedly()`</span>, where <span class="ge">*n*</span> &gt;=
    0, the cardinality is <span class="sb">`Times(AtLeast(n))`</span>.

<span class="gs">**Quick quiz:**</span> what do you think will happen if a function is expected to be
called twice but actually called four times?

<span class="gu">### Actions: What Should It Do?</span>

Remember that a mock object doesn&#39;t really have a working implementation? We as
users have to tell it what to do when a method is invoked. This is easy in
gMock.

First, if the return type of a mock function is a built-in type or a pointer,
the function has a <span class="gs">**default action**</span> (a <span class="sb">`void`</span> function will just return, a
<span class="sb">`bool`</span> function will return <span class="sb">`false`</span>, and other functions will return 0). In
addition, in C++ 11 and above, a mock function whose return type is
default-constructible (i.e. has a default constructor) has a default action of
returning a default-constructed value. If you don&#39;t say anything, this behavior
will be used.

Second, if a mock function doesn&#39;t have a default action, or the default action
doesn&#39;t suit you, you can specify the action to be taken each time the
expectation matches using a series of <span class="sb">`WillOnce()`</span> clauses followed by an
optional <span class="sb">`WillRepeatedly()`</span>. For example,

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GetX</span><span class="p">())</span>
<span class="w">     </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="w">     </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
<span class="w">     </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">300</span><span class="p">));</span>
<span class="sb">```</span>

says that <span class="sb">`turtle.GetX()`</span> will be called <span class="ge">*exactly three times*</span> (gMock inferred
this from how many <span class="sb">`WillOnce()`</span> clauses we&#39;ve written, since we didn&#39;t
explicitly write <span class="sb">`Times()`</span>), and will return 100, 200, and 300 respectively.

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GetY</span><span class="p">())</span>
<span class="w">     </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="w">     </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
<span class="w">     </span><span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">300</span><span class="p">));</span>
<span class="sb">```</span>

says that <span class="sb">`turtle.GetY()`</span> will be called <span class="ge">*at least twice*</span> (gMock knows this as
we&#39;ve written two <span class="sb">`WillOnce()`</span> clauses and a <span class="sb">`WillRepeatedly()`</span> while having no
explicit <span class="sb">`Times()`</span>), will return 100 and 200 respectively the first two times,
and 300 from the third time on.

Of course, if you explicitly write a <span class="sb">`Times()`</span>, gMock will not try to infer the
cardinality itself. What if the number you specified is larger than there are
<span class="sb">`WillOnce()`</span> clauses? Well, after all <span class="sb">`WillOnce()`</span>s are used up, gMock will do
the <span class="ge">*default*</span> action for the function every time (unless, of course, you have a
<span class="sb">`WillRepeatedly()`</span>.).

What can we do inside <span class="sb">`WillOnce()`</span> besides <span class="sb">`Return()`</span>? You can return a
reference using <span class="sb">`ReturnRef(`</span>*<span class="sb">`variable`</span>*<span class="sb">`)`</span>, or invoke a pre-defined function,
among [<span class="nt">others</span>](<span class="na">gmock_cook_book.md#using-actions</span>).

<span class="gs">**Important note:**</span> The <span class="sb">`EXPECT_CALL()`</span> statement evaluates the action clause
only once, even though the action may be performed many times. Therefore you
must be careful about side effects. The following may not do what you want:

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GetX</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">n</span><span class="o">++</span><span class="p">));</span>
<span class="sb">```</span>

Instead of returning 100, 101, 102, ..., consecutively, this mock function will
always return 100 as <span class="sb">`n++`</span> is only evaluated once. Similarly, <span class="sb">`Return(new Foo)`</span>
will create a new <span class="sb">`Foo`</span> object when the <span class="sb">`EXPECT_CALL()`</span> is executed, and will
return the same pointer every time. If you want the side effect to happen every
time, you need to define a custom action, which we&#39;ll teach in the
[<span class="nt">cook book</span>](<span class="na">gmock_cook_book.md</span>).

Time for another quiz! What do you think the following means?

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GetY</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<span class="sb">```</span>

Obviously <span class="sb">`turtle.GetY()`</span> is expected to be called four times. But if you think
it will return 100 every time, think twice! Remember that one <span class="sb">`WillOnce()`</span>
clause will be consumed each time the function is invoked and the default action
will be taken afterwards. So the right answer is that <span class="sb">`turtle.GetY()`</span> will
return 100 the first time, but <span class="gs">**return 0 from the second time on**</span>, as
returning 0 is the default action for <span class="sb">`int`</span> functions.

<span class="gu">### Using Multiple Expectations {#MultiExpectations}</span>

So far we&#39;ve only shown examples where you have a single expectation. More
realistically, you&#39;ll specify expectations on multiple mock methods which may be
from multiple mock objects.

By default, when a mock method is invoked, gMock will search the expectations in
the <span class="gs">**reverse order**</span> they are defined, and stop when an active expectation that
matches the arguments is found (you can think of it as &quot;newer rules override
older ones.&quot;). If the matching expectation cannot take any more calls, you will
get an upper-bound-violated failure. Here&#39;s an example:

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">Forward</span><span class="p">(</span><span class="n">_</span><span class="p">));</span><span class="w">  </span><span class="c1">// #1</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">Forward</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="w">  </span><span class="c1">// #2</span>
<span class="w">    </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="sb">```</span>

If <span class="sb">`Forward(10)`</span> is called three times in a row, the third time it will be an
error, as the last matching expectation (#2) has been saturated. If, however,
the third <span class="sb">`Forward(10)`</span> call is replaced by <span class="sb">`Forward(20)`</span>, then it would be OK,
as now <span class="ni">#1</span> will be the matching expectation.

{: .callout .note}
<span class="gs">**Note:**</span> Why does gMock search for a match in the <span class="ge">*reverse*</span> order of the
expectations? The reason is that this allows a user to set up the default
expectations in a mock object&#39;s constructor or the test fixture&#39;s set-up phase
and then customize the mock by writing more specific expectations in the test
body. So, if you have two expectations on the same method, you want to put the
one with more specific matchers <span class="gs">**after**</span> the other, or the more specific rule
would be shadowed by the more general one that comes after it.

{: .callout .tip}
<span class="gs">**Tip:**</span> It is very common to start with a catch-all expectation for a method
and <span class="sb">`Times(AnyNumber())`</span> (omitting arguments, or with <span class="sb">`_`</span> for all arguments, if
overloaded). This makes any calls to the method expected. This is not necessary
for methods that are not mentioned at all (these are &quot;uninteresting&quot;), but is
useful for methods that have some expectations, but for which other calls are
ok. See
[<span class="nt">Understanding Uninteresting vs Unexpected Calls</span>](<span class="na">gmock_cook_book.md#uninteresting-vs-unexpected</span>).

<span class="gu">### Ordered vs Unordered Calls {#OrderedCalls}</span>

By default, an expectation can match a call even though an earlier expectation
hasn&#39;t been satisfied. In other words, the calls don&#39;t have to occur in the
order the expectations are specified.

Sometimes, you may want all the expected calls to occur in a strict order. To
say this in gMock is easy:

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InSequence</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span><span class="w"> </span><span class="n">DrawsLineSegment</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">InSequence</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span>

<span class="w">    </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">PenDown</span><span class="p">());</span>
<span class="w">    </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">Forward</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<span class="w">    </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">PenUp</span><span class="p">());</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">Foo</span><span class="p">();</span>
<span class="p">}</span>
<span class="sb">```</span>

By creating an object of type <span class="sb">`InSequence`</span>, all expectations in its scope are
put into a <span class="ge">*sequence*</span> and have to occur <span class="ge">*sequentially*</span>. Since we are just
relying on the constructor and destructor of this object to do the actual work,
its name is really irrelevant.

In this example, we test that <span class="sb">`Foo()`</span> calls the three expected functions in the
order as written. If a call is made out-of-order, it will be an error.

(What if you care about the relative order of some of the calls, but not all of
them? Can you specify an arbitrary partial order? The answer is ... yes! The
details can be found [<span class="nt">here</span>](<span class="na">gmock_cook_book.md#OrderedCalls</span>).)

<span class="gu">### All Expectations Are Sticky (Unless Said Otherwise) {#StickyExpectations}</span>

Now let&#39;s do a quick quiz to see how well you can use this mock stuff already.
How would you test that the turtle is asked to go to the origin <span class="ge">*exactly twice*</span>
(you want to ignore any other instructions it receives)?

After you&#39;ve come up with your answer, take a look at ours and compare notes
(solve it yourself first - don&#39;t cheat!):

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AnyNumber</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GoTo</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">))</span><span class="w">  </span><span class="c1">// #1</span>
<span class="w">     </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AnyNumber</span><span class="p">());</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GoTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w">  </span><span class="c1">// #2</span>
<span class="w">     </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="sb">```</span>

Suppose <span class="sb">`turtle.GoTo(0, 0)`</span> is called three times. In the third time, gMock will
see that the arguments match expectation <span class="ni">#2</span> (remember that we always pick the
last matching expectation). Now, since we said that there should be only two
such calls, gMock will report an error immediately. This is basically what we&#39;ve
told you in the [<span class="nt">Using Multiple Expectations</span>](<span class="na">#MultiExpectations</span>) section above.

This example shows that <span class="gs">**expectations in gMock are &quot;sticky&quot; by default**</span>, in
the sense that they remain active even after we have reached their invocation
upper bounds. This is an important rule to remember, as it affects the meaning
of the spec, and is <span class="gs">**different**</span> to how it&#39;s done in many other mocking
frameworks (Why&#39;d we do that? Because we think our rule makes the common cases
easier to express and understand.).

Simple? Let&#39;s see if you&#39;ve really understood it: what does the following code
say?

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GetX</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">i</span><span class="p">));</span>
<span class="p">}</span>
<span class="sb">```</span>

If you think it says that <span class="sb">`turtle.GetX()`</span> will be called <span class="sb">`n`</span> times and will
return 10, 20, 30, ..., consecutively, think twice! The problem is that, as we
said, expectations are sticky. So, the second time <span class="sb">`turtle.GetX()`</span> is called,
the last (latest) <span class="sb">`EXPECT_CALL()`</span> statement will match, and will immediately
lead to an &quot;upper bound violated&quot; error - this piece of code is not very useful!

One correct way of saying that <span class="sb">`turtle.GetX()`</span> will return 10, 20, 30, ..., is
to explicitly say that the expectations are <span class="ge">*not*</span> sticky. In other words, they
should <span class="ge">*retire*</span> as soon as they are saturated:

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GetX</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
<span class="p">}</span>
<span class="sb">```</span>

And, there&#39;s a better way to do it: in this case, we expect the calls to occur
in a specific order, and we line up the actions to match the order. Since the
order is important here, we should make it explicit using a sequence:

<span class="sb">```cpp</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InSequence</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">InSequence</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span><span class="w"> </span><span class="n">GetX</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="sb">```</span>

By the way, the other situation where an expectation may <span class="ge">*not*</span> be sticky is when
it&#39;s in a sequence - as soon as another expectation that comes after it in the
sequence has been used, it automatically retires (and will never be used to
match any call).

<span class="gu">### Uninteresting Calls</span>

A mock object may have many methods, and not all of them are that interesting.
For example, in some tests we may not care about how many times <span class="sb">`GetX()`</span> and
<span class="sb">`GetY()`</span> get called.

In gMock, if you are not interested in a method, just don&#39;t say anything about
it. If a call to this method occurs, you&#39;ll see a warning in the test output,
but it won&#39;t be a failure. This is called &quot;naggy&quot; behavior; to change, see
[<span class="nt">The Nice, the Strict, and the Naggy</span>](<span class="na">gmock_cook_book.md#NiceStrictNaggy</span>).
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2024, Wageningen University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #D0F1C6; */
    }
    /* Sidebar */
    .wy-nav-side {
      /* background: #ff0000; */
    }
  </style>


</body>
</html>
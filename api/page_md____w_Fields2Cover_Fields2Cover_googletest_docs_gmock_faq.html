

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Legacy gMock FAQ &mdash; Fields2Cover latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../_static/code-tabs.css?v=1bc26e2f" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="https://fields2cover.github.io/api/page_md____w_Fields2Cover_Fields2Cover_googletest_docs_gmock_faq.html" />
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=c6e86fd7"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/code-tabs.js?v=c983d12e"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_fields2cover.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Fields2Cover</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/migration_to_v2.html">Migration guide to version 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="f2c_library.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Fields2Cover</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Legacy gMock FAQ</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/page_md____w_Fields2Cover_Fields2Cover_googletest_docs_gmock_faq.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="legacy-gmock-faq">
<span id="page-md-w-fields2cover-fields2cover-googletest-docs-gmock-faq"></span><h1>Legacy gMock FAQ<a class="headerlink" href="#legacy-gmock-faq" title="Link to this heading"></a></h1>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="md____w_Fields2Cover_Fields2Cover_googletest_docs_gmock_faq"></span><em><span class="pre">page</span></em> <span class="sig-name descname"><span class="pre">Legacy</span> <span class="pre">gMock</span> <span class="pre">FAQ</span></span></dt>
<dd><p><em>When I call a method on my mock object, the method for the real object is invoked instead. What’s the problem?</em></p>
<p>In order for a method to be mocked, it must be <em>virtual</em>, unless you use the <a class="reference external" href="gmock_cook_book.md#MockingNonVirtualMethods">high-perf dependency injection technique</a>.</p>
<p><em>Can I mock a variadic function?</em></p>
<p>You cannot mock a variadic function (i.e. a function taking ellipsis (<code class="docutils literal notranslate"><span class="pre">...</span></code>) arguments) directly in gMock.</p>
<p>The problem is that in general, there is <em>no way</em> for a mock object to know how many arguments are passed to the variadic method, and what the arguments’ types are. Only the <em>author of the base class</em> knows the protocol, and we cannot look into his or her head.</p>
<p>Therefore, to mock such a function, the <em>user</em> must teach the mock object how to figure out the number of arguments and their types. One way to do it is to provide overloaded versions of the function.</p>
<p>Ellipsis arguments are inherited from C and not really a C++ feature. They are unsafe to use and don’t work with arguments that have constructors or destructors. Therefore we recommend to avoid them in C++ as much as possible.</p>
<p><em>MSVC gives me warning C4301 or C4373 when I define a mock method with a const parameter. Why?</em></p>
<p>If you compile this using Microsoft Visual C++ 2005 SP1:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Bar</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MockFoo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre></div>
</div>
<p>You may get the following warning:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>warning<span class="w"> </span>C4301:<span class="w"> </span><span class="s1">&#39;MockFoo::Bar&#39;</span>:<span class="w"> </span>overriding<span class="w"> </span>virtual<span class="w"> </span><span class="k">function</span><span class="w"> </span>only<span class="w"> </span>differs<span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;Foo::Bar&#39;</span><span class="w"> </span>by<span class="w"> </span>const/volatile<span class="w"> </span>qualifier
</pre></div>
</div>
<p>This is a MSVC bug. The same code compiles fine with gcc, for example. If you use Visual C++ 2008 SP1, you would get the warning:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>warning<span class="w"> </span>C4373:<span class="w"> </span><span class="s1">&#39;MockFoo::Bar&#39;</span>:<span class="w"> </span>virtual<span class="w"> </span><span class="k">function</span><span class="w"> </span>overrides<span class="w"> </span><span class="s1">&#39;Foo::Bar&#39;</span>,<span class="w"> </span>previous<span class="w"> </span>versions<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>compiler<span class="w"> </span>did<span class="w"> </span>not<span class="w"> </span>override<span class="w"> </span>when<span class="w"> </span>parameters<span class="w"> </span>only<span class="w"> </span>differed<span class="w"> </span>by<span class="w"> </span>const/volatile<span class="w"> </span>qualifiers
</pre></div>
</div>
<p>In C++, if you <em>declare</em> a function with a <code class="docutils literal notranslate"><span class="pre">const</span></code> parameter, the <code class="docutils literal notranslate"><span class="pre">const</span></code> modifier is ignored. Therefore, the <code class="docutils literal notranslate"><span class="pre">Foo</span></code> base class above is equivalent to:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Bar</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// int or const int?  Makes no difference.</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In fact, you can <em>declare</em> <code class="docutils literal notranslate"><span class="pre">Bar()</span></code> with an <code class="docutils literal notranslate"><span class="pre">int</span></code> parameter, and define it with a <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">int</span></code> parameter. The compiler will still match them up.</p>
<p>Since making a parameter <code class="docutils literal notranslate"><span class="pre">const</span></code> is meaningless in the method declaration, we recommend to remove it in both <code class="docutils literal notranslate"><span class="pre">Foo</span></code> and <code class="docutils literal notranslate"><span class="pre">MockFoo</span></code>. That should workaround the VC bug.</p>
<p>Note that we are talking about the <em>top-level</em> <code class="docutils literal notranslate"><span class="pre">const</span></code> modifier here. If the function parameter is passed by pointer or reference, declaring the pointee or referee as <code class="docutils literal notranslate"><span class="pre">const</span></code> is still meaningful. For example, the following two declarations are <em>not</em> equivalent:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">Bar</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">);</span><span class="w">         </span><span class="c1">// Neither p nor *p is const.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">Bar</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">);</span><span class="w">  </span><span class="c1">// p is not const, but *p is.</span>
</pre></div>
</div>
<p><em>I can’t figure out why gMock thinks my expectations are not satisfied. What should I do?</em></p>
<p>You might want to run your test with <code class="docutils literal notranslate"><span class="pre">--gmock_verbose=info</span></code>. This flag lets gMock print a trace of every mock function call it receives. By studying the trace, you’ll gain insights on why the expectations you set are not met.</p>
<p><p>If you see the message “The mock function has no default action set, and its</p>
<p>return type has no default value set.”, then try</p>
<a class="reference external" href="gmock_cheat_sheet.md#OnCall">adding a default action</a>. Due to a known issue, unexpected calls on mocks without default actions don’t print out a detailed comparison between the actual arguments and the expected arguments.</p>
<p><em>My program crashed and <code class="docutils literal notranslate"><span class="pre">ScopedMockLog</span></code> spit out tons of messages. Is it a gMock bug?</em></p>
<p>gMock and <code class="docutils literal notranslate"><span class="pre">ScopedMockLog</span></code> are likely doing the right thing here.</p>
<p>When a test crashes, the failure signal handler will try to log a lot of information (the stack trace, and the address map, for example). The messages are compounded if you have many threads with depth stacks. When <code class="docutils literal notranslate"><span class="pre">ScopedMockLog</span></code> intercepts these messages and finds that they don’t match any expectations, it prints an error for each of them.</p>
<p>You can learn to ignore the errors, or you can rewrite your expectations to make your test more robust, for example, by adding something like:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AnyNumber</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Not</span><span class="p">;</span>
<span class="p">...</span>
<span class="w">  </span><span class="c1">// Ignores any log not done by us.</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">log</span><span class="p">,</span><span class="w"> </span><span class="n">Log</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">Not</span><span class="p">(</span><span class="n">EndsWith</span><span class="p">(</span><span class="s">&quot;/my_file.cc&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">_</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AnyNumber</span><span class="p">());</span>
</pre></div>
</div>
<p><em>How can I assert that a function is NEVER called?</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p><em>I have a failed test where gMock tells me TWICE that a particular expectation is not satisfied. Isn’t this redundant?</em></p>
<p>When gMock detects a failure, it prints relevant information (the mock function arguments, the state of relevant expectations, and etc) to help the user debug. If another failure is detected, gMock will do the same, including printing the state of relevant expectations.</p>
<p>Sometimes an expectation’s state didn’t change between two failures, and you’ll see the same description of the state twice. They are however <em>not</em> redundant, as they refer to <em>different points in time</em>. The fact they are the same <em>is</em> interesting information.</p>
<p><em>I get a heapcheck failure when using a mock object, but using a real object is fine. What can be wrong?</em></p>
<p>Does the class (hopefully a pure interface) you are mocking have a virtual destructor?</p>
<p>Whenever you derive from a base class, make sure its destructor is virtual. Otherwise Bad Things will happen. Consider the following code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="c1">// Not virtual, but should be.</span>
<span class="w">  </span><span class="o">~</span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">};</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="p">...</span>
<span class="w"> </span><span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">value_</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">...</span>
<span class="w">  </span><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Derived</span><span class="p">;</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">delete</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w">  </span><span class="c1">// Surprise! ~Base() will be called, but ~Derived() will not</span>
<span class="w">                 </span><span class="c1">// - value_ is leaked.</span>
</pre></div>
</div>
<p>By changing <code class="docutils literal notranslate"><span class="pre">~Base()</span></code> to virtual, <code class="docutils literal notranslate"><span class="pre">~Derived()</span></code> will be correctly called when <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">p</span></code> is executed, and the heap checker will be happy.</p>
<p><em>The “newer expectations override older ones” rule makes writing expectations awkward. Why does gMock do that?</em></p>
<p>When people complain about this, often they are referring to code like:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="w">  </span><span class="c1">// foo.Bar() should be called twice, return 1 the first time, and return</span>
<span class="w">  </span><span class="c1">// 2 the second time.  However, I have to write the expectations in the</span>
<span class="w">  </span><span class="c1">// reverse order.  This sucks big time!!!</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
</pre></div>
</div>
<p>The problem, is that they didn’t pick the <strong>best</strong> way to express the test’s intent.</p>
<p>By default, expectations don’t have to be matched in <em>any</em> particular order. If you want them to match in a certain order, you need to be explicit. This is gMock’s (and jMock’s) fundamental philosophy: it’s easy to accidentally over-specify your tests, and we want to make it harder to do so.</p>
<p>There are two better ways to write the test spec. You could either put the expectations in sequence:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="w">  </span><span class="c1">// foo.Bar() should be called twice, return 1 the first time, and return</span>
<span class="w">  </span><span class="c1">// 2 the second time.  Using a sequence, we can write the expectations</span>
<span class="w">  </span><span class="c1">// in their natural order.</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">InSequence</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
<span class="w">    </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>or you can put the sequence of actions in the same expectation:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="w">  </span><span class="c1">// foo.Bar() should be called twice, return 1 the first time, and return</span>
<span class="w">  </span><span class="c1">// 2 the second time.</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
</pre></div>
</div>
<p>Back to the original questions: why does gMock search the expectations (and <code class="docutils literal notranslate"><span class="pre">ON_CALL</span></code>s) from back to front? Because this allows a user to set up a mock’s behavior for the common case early (e.g. in the mock’s constructor or the test fixture’s set-up phase) and customize it with more specific rules later. If gMock searches from front to back, this very useful pattern won’t be possible.</p>
<p><em>gMock prints a warning when a function without EXPECT_CALL is called, even if I have set its behavior using ON_CALL. Would it be reasonable not to show the warning in this case?</em></p>
<p>When choosing between being neat and being safe, we lean toward the latter. So the answer is that we think it’s better to show the warning.</p>
<p>Often people write <code class="docutils literal notranslate"><span class="pre">ON_CALL</span></code>s in the mock object’s constructor or <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code>, as the default behavior rarely changes from test to test. Then in the test body they set the expectations, which are often different for each test. Having an <code class="docutils literal notranslate"><span class="pre">ON_CALL</span></code> in the set-up part of a test doesn’t mean that the calls are expected. If there’s no <code class="docutils literal notranslate"><span class="pre">EXPECT_CALL</span></code> and the method is called, it’s possibly an error. If we quietly let the call go through without notifying the user, bugs may creep in unnoticed.</p>
<p>If, however, you are sure that the calls are OK, you can write</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(...);</span>
</pre></div>
</div>
<p>instead of</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
<span class="w">  </span><span class="n">ON_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">WillByDefault</span><span class="p">(...);</span>
</pre></div>
</div>
<p>This tells gMock that you do expect the calls and no warning should be printed.</p>
<p>Also, you can control the verbosity by specifying <code class="docutils literal notranslate"><span class="pre">--gmock_verbose=error</span></code>. Other values are <code class="docutils literal notranslate"><span class="pre">info</span></code> and <code class="docutils literal notranslate"><span class="pre">warning</span></code>. If you find the output too noisy when debugging, just choose a less verbose level.</p>
<p><em>How can I delete the mock function’s argument in an action?</em></p>
<p>If your mock function takes a pointer argument and you want to delete that argument, you can use testing::DeleteArg&lt;N&gt;() to delete the N’th (zero-indexed) argument:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">X</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Y</span><span class="o">&amp;</span><span class="w"> </span><span class="n">y</span><span class="p">));</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_foo_</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">testing</span><span class="o">::</span><span class="n">DeleteArg</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">()));</span>
</pre></div>
</div>
<p><em>How can I perform an arbitrary action on a mock function’s argument?</em></p>
<p>If you find yourself needing to perform some action that’s not supported by gMock directly, remember that you can define your own actions using <a class="reference external" href="#NewMonoActions"></a> or <a class="reference external" href="#NewPolyActions"></a>, or you can write a stub function and invoke it using <a class="reference external" href="#FunctionsAsActions"></a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">X</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">));</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_foo_</span><span class="p">,</span><span class="w"> </span><span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">MyAction</span><span class="p">(...)));</span>
</pre></div>
</div>
<p><em>My code calls a static/global function. Can I mock it?</em></p>
<p>You can, but you need to make some changes.</p>
<p>In general, if you find yourself needing to mock a static function, it’s a sign that your modules are too tightly coupled (and less flexible, less reusable, less testable, etc). You are probably better off defining a small interface and call the function through that interface, which then can be easily mocked. It’s a bit of work initially, but usually pays for itself quickly.</p>
<p>This Google Testing Blog <a class="reference external" href="https://testing.googleblog.com/2008/06/defeat-static-cling.html">post</a> says it excellently. Check it out.</p>
<p><em>My mock object needs to do complex stuff. It’s a lot of pain to specify the actions. gMock sucks!</em></p>
<p>I know it’s not a question, but you get an answer for free any way. :-)</p>
<p>With gMock, you can create mocks in C++ easily. And people might be tempted to use them everywhere. Sometimes they work great, and sometimes you may find them, well, a pain to use. So, what’s wrong in the latter case?</p>
<p>When you write a test without using mocks, you exercise the code and assert that it returns the correct value or that the system is in an expected state. This is sometimes called “state-based testing”.</p>
<p>Mocks are great for what some call “interaction-based” testing: instead of checking the system state at the very end, mock objects verify that they are invoked the right way and report an error as soon as it arises, giving you a handle on the precise context in which the error was triggered. This is often more effective and economical to do than state-based testing.</p>
<p>If you are doing state-based testing and using a test double just to simulate the real object, you are probably better off using a fake. Using a mock in this case causes pain, as it’s not a strong point for mocks to perform complex actions. If you experience this and think that mocks suck, you are just not using the right tool for your problem. Or, you might be trying to solve the wrong problem. :-)</p>
<p><em>I got a warning “Uninteresting function call encountered - default action taken..” Should I panic?</em></p>
<p>By all means, NO! It’s just an FYI. :-)</p>
<p>What it means is that you have a mock function, you haven’t set any expectations on it (by gMock’s rule this means that you are not interested in calls to this function and therefore it can be called any number of times), and it is called. That’s OK - you didn’t say it’s not OK to call the function!</p>
<p>What if you actually meant to disallow this function to be called, but forgot to write <code class="docutils literal notranslate"><span class="pre">EXPECT_CALL(foo,</span> <span class="pre">Bar()).Times(0)</span></code>? While one can argue that it’s the user’s fault, gMock tries to be nice and prints you a note.</p>
<p>So, when you see the message and believe that there shouldn’t be any uninteresting calls, you should investigate what’s going on. To make your life easier, gMock dumps the stack trace when an uninteresting call is encountered. From that you can figure out which mock function it is, and how it is called.</p>
<p><em>I want to define a custom action. Should I use Invoke() or implement the ActionInterface interface?</em></p>
<p>Either way is fine - you want to choose the one that’s more convenient for your circumstance.</p>
<p>Usually, if your action is for a particular function type, defining it using <code class="docutils literal notranslate"><span class="pre">Invoke()</span></code> should be easier; if your action can be used in functions of different types (e.g. if you are defining <code class="docutils literal notranslate"><span class="pre">Return(*value*)</span></code>), <code class="docutils literal notranslate"><span class="pre">MakePolymorphicAction()</span></code> is easiest. Sometimes you want precise control on what types of functions the action can be used in, and implementing <code class="docutils literal notranslate"><span class="pre">ActionInterface</span></code> is the way to go here. See the implementation of <code class="docutils literal notranslate"><span class="pre">Return()</span></code> in <code class="docutils literal notranslate"><span class="pre">gmock-actions.h</span></code> for an example.</p>
<p><em>I use SetArgPointee() in WillOnce(), but gcc complains about “conflicting return type specified”. What does it mean?</em></p>
<p>You got this error as gMock has no idea what value it should return when the mock method is called. <code class="docutils literal notranslate"><span class="pre">SetArgPointee()</span></code> says what the side effect is, but doesn’t say what the return value should be. You need <code class="docutils literal notranslate"><span class="pre">DoAll()</span></code> to chain a <code class="docutils literal notranslate"><span class="pre">SetArgPointee()</span></code> with a <code class="docutils literal notranslate"><span class="pre">Return()</span></code> that provides a value appropriate to the API being mocked.</p>
<p>See this <a class="reference external" href="gmock_cook_book.md#mocking-side-effects">recipe</a> for more details and an example.</p>
<p><em>I have a huge mock class, and Microsoft Visual C++ runs out of memory when compiling it. What can I do?</em></p>
<p>We’ve noticed that when the <code class="docutils literal notranslate"><span class="pre">/clr</span></code> compiler flag is used, Visual C++ uses 5~6 times as much memory when compiling a mock class. We suggest to avoid <code class="docutils literal notranslate"><span class="pre">/clr</span></code> when compiling native C++ mocks. </p>
</dd></dl>

</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2024, Wageningen University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #D0F1C6; */
    }
    /* Sidebar */
    .wy-nav-side {
      /* background: #ff0000; */
    }
  </style>


</body>
</html>